#include "shared.h"

#include <sys/stat.h>
#include <stdio.h>


const char * FILE_TILL_EXPOLITED="/cache/recovery/.till_expolit_active";
								  /* if 1 then till has already ran, ignore successive install_recovery passes */
								  /* this file is actually set by toolbox.c when control returns with install_recovery context */						
									


//int is for expected value, const char * is for above const char * file path
int increment_value(int required_value, const char * targetfile){  /* if expected_value == current file value it will increment that value by 1
											   						  otherwise it will evulate false i.e. return 0 */
   int return_value;
   
   //retrieve the currently stored option value
   FILE *fp = fopen(targetfile, "r");
   if (fp == NULL) 
   {
//   	printf("check_value tested a null targetfile %s\n",targetfile);
   	return -1;
   }
	fscanf(fp, "%i", &return_value);
   		fclose(fp);

   //if the value was the required_value, i.e. if it was 0 for example
   if ( return_value == required_value ){
   		FILE *fp = fopen(targetfile, "w"); /* <DEBUG> "w" is overwrite but same permissons when file exists?, we will see */
   		if( fp != NULL ){
			return_value++; /* increment and reuse this variable */
   			fprintf(fp, "%i",return_value);
   			fclose(fp);
	   		return 1;
   		}else{return -1;}   
   }
//	printf("change attempt fail %s expected value: %i but was %i\n",targetfile, required_value, return_value);
	return 0;
}
