ARCH := $(shell adb shell getprop ro.product.cpu.abi)
SDK_VERSION := $(shell adb shell getprop ro.build.version.sdk)

all: build

build:
	ndk-build NDK_PROJECT_PATH=. APP_BUILD_SCRIPT=./Android.mk APP_ABI=$(ARCH) APP_PLATFORM=android-$(SDK_VERSION)

log: 
	adb logcat | grep -a GRP_Root_Kit
	
##Android 6.01 r1
root6: build 
## su install isn't working with locked bootloaders stil, partial working example only 

		adb push boot_img_extracted_and_prerooted_/ /data/local/tmp/
		adb push boot_push.img /data/local/tmp/		
##---------------------------------------------------------------------------------- the remaining parts remain unchanged
		adb push applypatch_android_6.01_r1 /data/local/tmp/till
		adb push root_cmd_list.txt /data/local/tmp/cmd_list.txt
		adb push toolbox_android_6.01_r1 /data/local/tmp/toolbox #precompile aosp toolbox must match your device
		adb push libs/$(ARCH)/dcow /data/local/tmp/dcow				
		adb push libs/$(ARCH)/farm /data/local/tmp/farm
		adb push libs/$(ARCH)/bridge /data/local/tmp/bridge
		adb shell chmod -R 0777 /data/local/tmp/*
		adb shell /data/local/tmp/farm	
	

testreset: build

		adb push adbd /data/local/tmp/adbd
##---------------------------------------------------------------------------------- the remaining parts remain unchanged
		adb push applypatch_android_6.01_r1 /data/local/tmp/till
		adb push testreset_cmd_list.txt /data/local/tmp/cmd_list.txt
		adb push toolbox_android_6.01_r1 /data/local/tmp/toolbox #precompile aosp toolbox must match your device
		adb push libs/$(ARCH)/dcow /data/local/tmp/dcow				
		adb push libs/$(ARCH)/farm /data/local/tmp/farm
		adb push libs/$(ARCH)/bridge /data/local/tmp/bridge
		adb shell chmod -R 0777 /data/local/tmp/*
		adb shell /data/local/tmp/farm

test: build

		adb push adbd /data/local/tmp/adbd
##---------------------------------------------------------------------------------- the remaining parts remain unchanged
		adb push applypatch_android_6.01_r1 /data/local/tmp/till
		adb push test_cmd_list.txt /data/local/tmp/cmd_list.txt
		adb push toolbox_android_6.01_r1 /data/local/tmp/toolbox #precompile aosp toolbox must match your device
		adb push libs/$(ARCH)/dcow /data/local/tmp/dcow				
		adb push libs/$(ARCH)/farm /data/local/tmp/farm
		adb push libs/$(ARCH)/bridge /data/local/tmp/bridge
		adb shell chmod -R 0777 /data/local/tmp/*
		adb shell /data/local/tmp/farm		

boot_push.img:
	@echo "place boot_push.img in the Greyhat Root Kit directory"
	
adbd:
	@echo "place a modified adbd binary in the Greyhat Root Kit directory"

su:
	@echo "su install files for your device needed to run this example"
	@echo "you can download these files for almost every device from chainfire"
		
##Android 5.11 r2
runreset5: build adbd
## adbd binary needed, place in directory with sources
		adb push adbd /data/local/tmp/
##---------------------------------------------------------------------------------- the remaining parts remain unchanged
		adb push applypatch_android-5.11_r2 /data/local/tmp/till
		adb push cmd_list.txt /data/local/tmp/cmd_list.txt ##!!! at the end of execution adbd will reset
		adb push toolbox_android_5.1.1_r2_reset_adb_host /data/local/tmp/toolbox #precompile aosp toolbox must match your device
		adb push libs/$(ARCH)/dcow /data/local/tmp/dcow				
		adb push libs/$(ARCH)/farm /data/local/tmp/farm
		adb push libs/$(ARCH)/bridge /data/local/tmp/bridge
		adb shell chmod -R 0777 /data/local/tmp/*
		adb shell /data/local/tmp/farm
		
##Android 6.01 r1
runreset6: build adbd
## adbd binary needed, place in directory with sources
		adb push adbd /data/local/tmp/
##---------------------------------------------------------------------------------- the remaining parts remain unchanged
		adb push applypatch_android_6.01_r1 /data/local/tmp/till
		adb push cmd_list.txt /data/local/tmp/cmd_list.txt ##!!! at the end of execution adbd will reset
		adb push toolbox_android_6.01_r1 /data/local/tmp/toolbox #precompile aosp toolbox must match your device
		adb push libs/$(ARCH)/dcow /data/local/tmp/dcow				
		adb push libs/$(ARCH)/farm /data/local/tmp/farm
		adb push libs/$(ARCH)/bridge /data/local/tmp/bridge
		adb shell chmod -R 0777 /data/local/tmp/*
		adb shell /data/local/tmp/farm

clean:
	rm -rf libs
	rm -rf obj

##Android 5.11 r2, example only
su5: build su
## su install isn't working with locked bootloaders stil, partial working example only 
		## su 64 bit files
		adb push su/ /data/local/tmp/su
		adb shell chmod -R 0777 /data/local/tmp/su/*
##---------------------------------------------------------------------------------- the remaining parts remain unchanged
		adb push su_cmd_list.txt /data/local/tmp/cmd_list.txt
		adb push toolbox_android_5.1.1_r2 /data/local/tmp/toolbox
		adb push applypatch_android-5.11_r2 /data/local/tmp/till
		adb push libs/$(ARCH)/dcow /data/local/tmp/dcow				
		adb push libs/$(ARCH)/farm /data/local/tmp/farm
		adb push libs/$(ARCH)/bridge /data/local/tmp/bridge
		adb shell chmod -R 0777 /data/local/tmp/*
		adb shell /data/local/tmp/farm

##Android 6.01 r1, example only
su6: build su
## su install isn't working with locked bootloaders stil, partial working example only 
		## su 64 bit files
		adb push su/ /data/local/tmp/
##---------------------------------------------------------------------------------- the remaining parts remain unchanged
		adb push su_cmd_list.txt /data/local/tmp/cmd_list.txt
		adb push toolbox_android_6.01_r1 /data/local/tmp/toolbox #precompile aosp toolbox must match your device
		adb push applypatch_android_6.01_r1 /data/local/tmp/till
		adb push libs/$(ARCH)/dcow /data/local/tmp/dcow				
		adb push libs/$(ARCH)/farm /data/local/tmp/farm
		adb push libs/$(ARCH)/bridge /data/local/tmp/bridge		
		adb shell chmod -R 0777 /data/local/tmp/*
		adb shell /data/local/tmp/farm
