#include "shared.h"

#include <sys/stat.h>
#include <stdio.h>


										/* toolbox.c shouldn't read until bridge is finished writing */
										//~~~
										/* bridge.c dual purpose -- when RSF_SENT_FILE_LIST == 0 again toolbox is all done */
const char * RSF_SENT_FILE_LIST											= "/cache/recovery/.sent_file_list";						

										
const char * RSF_IREC_DONE="/cache/recovery/.irec_done";
								  		/* system _server / install_recovery both loop to test each line of cmd_list.txt 
											0 = install_recovery tests and if applies issues command
											1 = system_server test and then and if applies issues command */
									
		
		
		
		
		/* toolbox.c only run SERVER_CONTEXT once */
const char * RSF_TOOLBOX_RUN_ONCE = "/cache/recovery/.toolbox";






//set an integer value to represent an option.
int set_value(int targetvalue, const char * targetfile){
   FILE *fp = fopen(targetfile, "w"); /* <DEBUG> "w" is overwrite but same permissons when file exists?, we will see */
   if( fp != NULL ){
   		fprintf(fp, "%i",targetvalue);
   		fclose(fp);
   		return 1;
   }
	return 0;
}

//returns an integer from a text file
int check_value(const char * targetfile){
   int return_value;
   
   FILE *fp = fopen(targetfile, "r");
   if (fp == NULL) 
   {
   	printf("check_value tested a null targetfile %s\n",targetfile);
   	return -1;
   }
	fscanf(fp, "%i", &return_value);
    	     fclose(fp);
    	return return_value;
}

//int is for expected value, const char * is for above const char * file path
int increment_value(int required_value, const char * targetfile){  /* if expected_value == current file value it will increment that value by 1
											   						  otherwise it will evulate false i.e. return 0 */
   int return_value;
   
   //retrieve the currently stored option value
   FILE *fp = fopen(targetfile, "r");
   if (fp == NULL) 
   {
   	printf("check_value tested a null targetfile %s\n",targetfile);
   	return -1;
   }
	fscanf(fp, "%i", &return_value);
   		fclose(fp);

   //if the value was the required_value, i.e. if it was 0 for example
   if ( return_value == required_value ){
   		FILE *fp = fopen(targetfile, "w"); /* <DEBUG> "w" is overwrite but same permissons when file exists?, we will see */
   		if( fp != NULL ){
			return_value++; /* increment and reuse this variable */
   			fprintf(fp, "%i",return_value);
   			fclose(fp);
	   		return 1;
   		}else{return -1;}   
   }
	printf("change attempt fail %s expected value: %i but was %i\n",targetfile, required_value, return_value);
	return 0;
}
